<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Sensors test</title>
	<style type="text/css">
		span[style] {
/*			--c-pos: 120;*/
			background: hsl(var(--c-pos) 100% 75%);
			color: hsl(var(--c-pos) 100% 25%);
			display: inline-block;
			padding: 0 0.5em;
			border-radius: 0.5em;
		}
	</style>
</head>
<body>

<div id="msg"></div>
	
<div>
	acceleration:<br>
	x: <span id="acceleration_x"></span><br>
	y: <span id="acceleration_y"></span><br>
	z: <span id="acceleration_z"></span><br>
	length: <span id="acceleration_m"></span>
</div>

<!-- <div>
	acceleration:<br>
	x: <span id="acceleration_x"></span><br>
	y: <span id="acceleration_y"></span><br>
	z: <span id="acceleration_z"></span><br>
	length: <span id="acceleration_m"></span>
</div> -->





<script type="text/javascript">

	function toInterface(id, value, operation = '=') {
		document.querySelectorAll(`#${id}`).forEach(el=>{
			if (operation === '+=') {
				el.textContent += value
			} else {
				el.textContent = value
			}
			
		})
	}

	toInterface('acceleration_x', 'wating for data')
	toInterface('acceleration_y', 'wating for data')
	toInterface('acceleration_z', 'wating for data')




// const sensor = new AbsoluteOrientationSensor();
// Promise.all(['accelerometer','magnetometer','gyroscope'].map(name=>navigator.permissions.query({name: name}))).then(results=>{
// 	if (results.every(result=>result.state==="granted")) {
// 		sensor.start();
// 		console.log(sensor)
// 	} else {
// 		console.log("No permissions to use AbsoluteOrientationSensor.");
// 	}
// });

// if (navigator.permissions) {
// // https://w3c.github.io/orientation-sensor/#model
// 	Promise.all([navigator.permissions.query({ name: "accelerometer" }),
// 			 navigator.permissions.query({ name: "magnetometer" }),
// 			 navigator.permissions.query({ name: "gyroscope" })])
// 	   .then(results => {
// 			if (results.every(result => result.state === "granted")) {
// 				initSensor();
// 			} else {
// 				console.log("Permission to use sensor was denied.");
// 			}
// 		}).catch(err => {
// 			console.log("Integration with Permissions API is not enabled, still try to start app.");
// 			initSensor();
// 		});
// } else {
// 	console.log("No Permissions API, still try to start app.");
// 	initSensor();
// }

	//const aclKeys = ['activated','hasReading','onactivate','onerror','onreading','timestamp','x','y','z'] //Object.keys or Object.getOwnPropertyDescriptors cant do that so just as array





const vLen = (...v)=>Math.sqrt(v.reduce((ac,a)=>ac+a*a,0))

	Promise.all(['accelerometer'].map(name=>navigator.permissions.query({name: name}))).then(results=>{

		if (results.every(result=>result.state==="granted")) {

	const acl = new Accelerometer({frequency: 60});

acl.onreading = ()=>{
	toInterface('acceleration_x', acl.x)
	toInterface('acceleration_y', acl.y)
	toInterface('acceleration_z', acl.z)
	toInterface('acceleration_m', vLen(acl.x,acl.y,acl.z).toFixed(3) )
}
acl.onerror = (event) => {
	console.log(event)
	toInterface('msg', event.error.name + ' ' + event.error.message)
	if (event.error.name == 'NotReadableError') {
		// toInterface('msg', 'Sensor is not available')
	}
}		

			acl.start();

			// console.log(acl)

		} else {
			toInterface('msg','No permissions to use Accelerometer','+=');
		}
	});




</script>

</body>
</html>